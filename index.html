
<!doctype html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Raspberry Pi Mini Monitor</title>
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
	<script type="text/javascript">
		// Load the Visualization API and the piechart package.
		google.load('visualization', '1.0', {'packages':['corechart']});

		function drawChartCPU(dateP, loadP) {
			// Create the data table.
			var data = new google.visualization.DataTable();
			var len = dateP.length;
	
			data.addColumn('datetime', 'Time');
			data.addColumn('number', 'Load');
			data.addRows(len);
	
			var i = 0;
	
			while (i < len)
			{	
				var day = dateP[i].substring(0, 2);
				var month = dateP[i].substring(3, 5);
				var year = dateP[i].substring(6, 8);
				var time = dateP[i].substring(9, 17);
				var d = new Date(year, month, day, time.substring(0, 2), time.substring(3, 5), time.substring(6, 8));
				
				data.setCell(i, 0, d);
				data.setCell(i, 1, parseFloat(loadP[i]));
				i += 1;
			}
	
			// Set chart options
			var options = {'title':'CPU Load'};
	
			// Instantiate and draw our chart, passing in some options.
			var chart = new google.visualization.LineChart(document.getElementById('CPUchart'));
			chart.draw(data, options);
		}
		
		function drawChartMem(dateP, memP) {
			// Create the data table.
			var data = new google.visualization.DataTable();
			var len = dateP.length;
	
			data.addColumn('datetime', 'Time');			
			data.addColumn('number', 'Memory used');
			data.addRows(len);
	
			var i = 0;
	
			while (i < len)
			{	
				var day = dateP[i].substring(0, 2);
				var month = dateP[i].substring(3, 5);
				var year = dateP[i].substring(6, 8);
				var time = dateP[i].substring(9, 17);
				var d = new Date(year, month, day, time.substring(0, 2), time.substring(3, 5), time.substring(6, 8));
				
				data.setCell(i, 0, d);
				data.setCell(i, 1, parseFloat(memP[i]/1024));				
				
				i += 1;
			}					

			// Set chart options
			var options = {'title':'Memory use'};
	
			// Instantiate and draw our chart, passing in some options.
			var chart = new google.visualization.LineChart(document.getElementById('RAMchart'));
			chart.draw(data, options);
		}
		
		function drawChartTemp(dateP, tempP) {
			// Create the data table.
			var data = new google.visualization.DataTable();
			var len = dateP.length;
	
			data.addColumn('datetime', 'Time');
			data.addColumn('number', 'Temp ÂºC');
			data.addRows(len);
	
			var i = 0;
	
			while (i < len)
			{	
				var day = dateP[i].substring(0, 2);
				var month = dateP[i].substring(3, 5);
				var year = dateP[i].substring(6, 8);
				var time = dateP[i].substring(9, 17);
				var d = new Date(year, month, day, time.substring(0, 2), time.substring(3, 5), time.substring(6, 8));
				
				data.setCell(i, 0, d);
				data.setCell(i, 1, parseFloat(tempP[i]/1000));
				i += 1;
			}
	
			// Set chart options
			var options = {'title':'CPU Temperature'};
	
			// Instantiate and draw our chart, passing in some options.
			var chart = new google.visualization.LineChart(document.getElementById('Tempchart'));
			chart.draw(data, options);
		}
		
		$(document).ready(function () {
			$.get("log/stats.log", function(data) {
				var lines = data.split("\n");
				var i = 0;
				var date = [];
				var load = [];
				var mem = [];			
				var temp = [];
				
				$.each(lines, function(n, elem) {
					date[i] = elem.substring(0,17);
					load[i] = elem.substring(18,22);
					mem[i] = elem.substring(23,29);			
					temp[i] = elem.substring(30, 35);
					i += 1;				
				});

				drawChartCPU(date, load);
				drawChartMem(date, mem);
				drawChartTemp(date, temp);
			});
		});
		</script>
</head>
<body>
<div id="CPUchart"></div>
<div id="RAMchart"></div>
<div id="Tempchart"></div>
</body>
</html>
